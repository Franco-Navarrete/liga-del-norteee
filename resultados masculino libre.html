<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados Liga</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .btn-category {
            flex: 1 1 auto;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="text-center">
            <img src="imagenes/logoliga.png" width="100px" height="auto" alt="Logo Liga">
        </div>
        
        <div id="resultados-container"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_AUTH_DOMAIN",
            projectId: "TU_PROJECT_ID",
            storageBucket: "TU_STORAGE_BUCKET",
            messagingSenderId: "TU_MESSAGING_SENDER_ID",
            appId: "TU_APP_ID"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let isAuthenticated = false;

        firebase.auth().onAuthStateChanged(user => {
            isAuthenticated = !!user;
            cargarResultados();
        });
        
        async function cargarResultados() {
            const container = document.getElementById('resultados-container');
            container.innerHTML = '';
            
            const categorias = ["Libre", "Sub 16"];
            for (const categoria of categorias) {
                const snapshot = await db.collection(categoria).orderBy('fecha', 'asc').get();
                const monthMap = {};
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const fecha = new Date(data.fecha.seconds * 1000).toISOString().split('T')[0];
                    const mesAnio = new Date(fecha).toLocaleString('es-ES', { month: 'long', year: 'numeric' });
                    if (!monthMap[mesAnio]) monthMap[mesAnio] = [];
                    monthMap[mesAnio].push({...data, id: doc.id, categoria});
                });
                
                const months = Object.keys(monthMap).sort((a, b) => new Date(a) - new Date(b));
                months.forEach((monthYear, index) => {
                    const monthDiv = document.createElement('div');
                    monthDiv.classList.add('card', 'mt-3');
                    monthDiv.innerHTML = `
                        <div class="card-header bg-primary text-white">Fecha n° ${months.length - index} (${monthYear})</div>
                        <div class="card-body">
                            <ul class="list-group">${monthMap[monthYear].map(partido => `
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    ${partido.equipo1} (${partido.goles1}) vs (${partido.goles2}) ${partido.equipo2}
                                    ${isAuthenticated ? `
                                    <button class="btn btn-warning btn-sm" onclick="editarResultado('${partido.id}', '${partido.categoria}')">Editar</button>
                                    <button class="btn btn-danger btn-sm" onclick="eliminarResultado('${partido.id}', '${partido.categoria}')">Eliminar</button>
                                    ` : ''}
                                </li>`).join('')}
                            </ul>
                        </div>
                    `;
                    container.appendChild(monthDiv);
                });
            }
        }
        
        async function editarResultado(id, categoria) {
            const doc = await db.collection(categoria).doc(id).get();
            if (doc.exists) {
                const data = doc.data();
                document.getElementById('equipo1').value = data.equipo1;
                document.getElementById('goles1').value = data.goles1;
                document.getElementById('goles2').value = data.goles2;
                document.getElementById('equipo2').value = data.equipo2;
                document.getElementById('fecha').value = new Date(data.fecha.seconds * 1000).toISOString().split('T')[0];
                editingId = id;
            }
        }
        
        async function eliminarResultado(id, categoria) {
            if (confirm("¿Seguro que deseas eliminar este resultado?")) {
                await db.collection(categoria).doc(id).delete();
                cargarResultados();
            }
        }
    </script>
</body>
</html>
